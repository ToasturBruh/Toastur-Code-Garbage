@name Harris Box
@inputs Seat:entity On Power
@outputs 
@persist E:entity Controls:table ControlCompile:table
@persist SelectorNotch IndpMotoring
@model models/rlc_delta_lua/accessories/harris_box_1.mdl

#Toast

if(first() | dupefinished()){
    
    Controls = table() #Don't touch
    
    #Touch
    Controls["Fence",string] = "pad_enter"
    
    Controls["NotchUp",string] = "pad_plus"
    Controls["NotchDn",string] = "pad_minus"
    
    #Compile a control table
    ControlCompile = table()
    foreach(K:string,V:string = Controls){
        ControlCompile[V,string] = K
    }
    
    #End config
    
    SelectorNotch = -2
    IndpMotoring = 0
    E = entity()
}

event keyPressed(Ply:entity, Key:string, Down:number, KeyBind:string){
    if(Ply == Seat:driver() & On & Power){
        if(Down == 1){
            if(ControlCompile[Key,string] == "NotchUp"){SelectorNotch++}
            if(ControlCompile[Key,string] == "NotchDn"){SelectorNotch--}
            if(ControlCompile[Key,string] == "Fence"){IndpMotoring = !IndpMotoring E:soundPlay("motoring",0,"monkssounds/buttons/button2.wav")}
            
            SelectorNotch = clamp(SelectorNotch,-2,8)
            
            print(SelectorNotch)
            
            E:setBoneAngRelative(E:boneIndex("notch_selector"),ang(-230*((SelectorNotch+2)/10),0,0))
            
            if(changed(SelectorNotch)){E:soundPlay("selector",0,"monkssounds/buttons/button35.wav")}
            
            if(SelectorNotch == -2){E:setBodygroup(4,1)}
            if(SelectorNotch == -1){E:setBodygroup(4,2)}
            if(SelectorNotch == 0){E:setBodygroup(4,3) IndpMotoring = 0}
            if(!IndpMotoring & SelectorNotch > 0){E:setBodygroup(4,3)}
            if(IndpMotoring & SelectorNotch > 0){E:setBodygroup(4,4)}
        }
    }
}

if(changed(SelectorNotch)){
    
}else{
    
}

if(On & Power){
    E:setBodygroup(13,2)#Console power
    E:setBodygroup(12,1)#Lead/Trail radio
    E:setBodygroup(6,1)#Comm status
    E:setBodygroup(3,1)#FV
    
    if(SelectorNotch == -2){E:setBodygroup(4,1)}
    if(SelectorNotch == -1){E:setBodygroup(4,2)}
    if(SelectorNotch == 0){E:setBodygroup(4,3)}
    if(!IndpMotoring & SelectorNotch > 0){E:setBodygroup(4,3)}
    
}else{
    IndpMotoring = 0
    
    if(On){
        E:setBodygroup(13,1)#Console power
    }else{
        E:setBodygroup(13,0)#Console power
    }
    
    E:setBodygroup(12,0)#Lead/Trail radio
    E:setBodygroup(6,0)#Comm status
    E:setBodygroup(4,0)#Mode
    E:setBodygroup(3,0)#FV
}

if(~Power){
    E:soundPlay("switch",0,"monkssounds/buttons/button21.wav")
    E:setBoneAngRelative(E:boneIndex("sw_pwr"),ang(30*-Power,0,0))
}
